function drawChart(){var t=[];$.each(fsym,function(e,r){t[r]=[],$.get("https://min-api.cryptocompare.com/data/histoday?aggregate=1&e=CCCAGG&extraParams=CryptoCompare&fsym="+r+"&limit=21&tryConversion=false&tsym=USD",function(e){$.each(e.Data,function(e,o){t[r][e]=[],t[r][e][0]=new Date(1e3*o.time).toString(),t[r][e][1]=o.close});var o={legend:"none",title:r,width:500,height:300,backgroundColor:"rgb(36,36,36)",hAxis:{textStyle:{color:"#FFF"}},vAxis:{textStyle:{color:"#FFF"}},titleTextStyle:{color:"#FFF"},areaOpacity:"0.7"};gTab=google.visualization.arrayToDataTable(t[r],!0),chart[r]=new google.visualization.AreaChart(document.getElementById(r+"-24h-chart-div")),chart[r].draw(gTab,o)},"json")})}var symLib=[],nameLib=[],imageLib=[],chart=[],fsym=["BTC","DASH","ETH","LTC","XMR","XRP","XVG"];const COIN_REFRESH_INTERVAL=5e3,CHART_REFRESH_INTERVAL=15e3;sortTable=function(){var t,e,r;for($table=$("#coins-tb"),t=!0;t;){for(t=!1,$rows=$table.children("tbody").children(),e=1;e<$rows.length-1;e++)if(r=!1,$($rows.get(e)).prop("id")>$($rows.get(e+1)).prop("id")){r=!0;break}r&&($($rows.get(e)).insertAfter($($rows.get(e+1))),t=!0)}},updateSymbols=function(){fsym.sort();var t="";return $.each(fsym,function(e,r){t=0==e?r:t+","+r}),t};var fsymStr=updateSymbols();reloadTicker=function(t){dataUSD=t.USD,dataBTC=t.BTC,t&&(symbol=dataUSD.FROMSYMBOL,curUSD=dataUSD.PRICE,curBTC=dataBTC.PRICE,$("#"+symbol).length?(prevUSD=parseFloat($("#"+symbol+"-price").text()),prevBTC=parseFloat($("#"+symbol+"-price").text())):($("#coins-tb").append($(document.createElement("TR")).prop("id",symbol)),prevUSD=curUSD,prevBTC=curBTC),changeUSD=" ",curUSD>prevUSD?changeUSD="+"+(curUSD-prevUSD).toFixed(2):curUSD<prevUSD&&(changeUSD="-"+(prevUSD-curUSD).toFixed(2)),changeBTC=" ",curBTC>prevBTC?changeBTC="+"+(curBTC-prevBTC).toPrecision(3):curBTC<prevBTC&&(changeBTC="-"+(prevBTC-curBTC).toPrecision(3)),$("#"+symbol).show(),$("#"+symbol).html("<td id='"+symbol+"-symbol'><a href='https://www.cryptocompare.com/coins/"+symbol+"/overview'><img class='icon' alt="+symbol+" src='https://www.cryptocompare.com"+imageLib[symbol]+"'></a>&nbsp;"+symbol+"</td><td id='"+symbol+"-name'>"+nameLib[symbol]+"</td><td id='"+symbol+"-price-usd'>"+parseFloat(dataUSD.PRICE).toFixed(2)+"</td><td id='"+symbol+"-change-usd'>"+changeUSD+"</td><td id='"+symbol+"-24h-change-usd'>"+parseFloat(dataUSD.CHANGE24HOUR).toFixed(2)+"</td><td id='"+symbol+"-price-btc'>"+parseFloat(dataBTC.PRICE).toPrecision(3)+"</td><td id='"+symbol+"-change-btc'>"+changeBTC+"</td><td id='"+symbol+"-24h-change-btc'>"+parseFloat(dataBTC.CHANGE24HOUR).toPrecision(3)+"</td><td id='"+symbol+"-24h-change-pct'>"+parseFloat(dataBTC.CHANGEPCT24HOUR).toPrecision(4)+"</td><td id='"+symbol+"-market-cap'>"+parseFloat(dataBTC.MKTCAP).toPrecision(12)+"</td><td id='"+symbol+"-update'>"+(new Date).toLocaleTimeString()+"</td><td id='"+symbol+"-hide'><button class='hider'>X</button></td>"),$("#"+symbol+"-24h-chart-div").length||$("#chart-container").append("<div id='"+symbol+"-24h-chart-div' class='chart' style='display:none'></div>"),$("#"+symbol+"-hide").find(".hider").click(function(){$this=$(this),$this.parents("tr").remove(),symbol=$this.parent().prop("id").split("-")[0],$("#"+symbol+"-24h-chart-div").remove(),fsym.splice(fsym.indexOf(symbol,1)),fsymStr=updateSymbols(),reboot()}),curUSD>prevUSD?$("#"+symbol+"-change-usd").css("color","lawngreen"):curUSD<prevUSD?$("#"+symbol+"-change-usd").css("color","crimson"):$("#"+symbol+"-change-usd").css("color","black"),curBTC>prevBTC?$("#"+symbol+"-change-btc").css("color","lawngreen"):curBTC<prevBTC?$("#"+symbol+"-change-btc").css("color","crimson"):$("#"+symbol+"-change-btc").css("color","black"),sortTable())},refreshCoins=function(){fsymStr.length>=3?$.get("https://min-api.cryptocompare.com/data/pricemultifull?fsyms="+fsymStr+"&tsyms=USD,BTC",function(t){$.each(t.RAW,function(t,e){reloadTicker(e)})},"json"):console.log("No symbols selected.")},$(function(){google.charts.load("current",{packages:["corechart"]}),$.each(rawCoins.Data,function(t,e){symLib.push(e.Symbol),nameLib[e.Symbol]=e.CoinName,imageLib[e.Symbol]=e.ImageUrl}),refreshCoins(),refresher=setInterval(refreshCoins,COIN_REFRESH_INTERVAL),charter=setInterval(drawChart,CHART_REFRESH_INTERVAL),clearInterval(charter),$("#chart-control").prop("checked")&&(drawChart(),charter=setInterval(drawChart,CHART_REFRESH_INTERVAL)),reboot=function(){clearInterval(refresher),clearInterval(charter),refreshCoins(),refresher=setInterval(refreshCoins,COIN_REFRESH_INTERVAL),$("#chart-control").prop("checked")&&(drawChart(),charter=setInterval(drawChart,CHART_REFRESH_INTERVAL))},$("#font-size-inc").click(function(){sz=parseFloat($("#coins-tb").css("font-size")),$("#coins-tb").css("font-size",sz+2)}),$("#font-size-dec").click(function(){sz=parseFloat($("#coins-tb").css("font-size")),$("#coins-tb").css("font-size",sz-2)}),$("#chart-control").click(function(){$(this).prop("checked")?($(".chart").show(),drawChart(),setInterval(drawChart,CHART_REFRESH_INTERVAL)):($(".chart").hide(),clearInterval(drawChart))}),$("#add-sym").click(function(){symLib.indexOf($("#sym-text").val())>=0?(fsym.push($("#sym-text").val()),fsymStr=updateSymbols(),sortTable(),reboot(),$("#sym-text").val("")):console.log("Symbol not found in library.")}),$("#sym-text").autocomplete({source:symLib})});